/* * Jquery timeline : jQuery plugin allowing you to transform a list of elements into a two columns timeline * Copyright 2013 Loïc B. Florin (@bf_loic) * Licensed under the MIT license. * Version 1.0 */(function(e){var t=e.event,n,r={_:0},i=0,s,o;n=t.special.throttledresize={setup:function(){e(this).on("resize",n.handler)},teardown:function(){e(this).off("resize",n.handler)},handler:function(u,a){var f=this,l=arguments;s=true;if(!o){setInterval(function(){i++;if(i>n.threshold&&s||a){u.type="throttledresize";t.dispatch.apply(f,l);s=false;i=0}if(i>9){e(r).stop();o=false;i=0}},30);o=true}},threshold:0};e.timeline=function(t,n){var r={item:".block",corner:false,wide:false,line:false,arrows:false,deletebtn:false,column:2,first:"right",animation:false,duration:2e3,onComplete:false,onRemoveItem:false};var i=this;i.settings={};var s=e(t),t=t;i.initialize=function(){i.settings=e.extend({},r,n);if(typeof i.settings.onComplete=="function")i.settings.onComplete(s);if(i.settings.animation){if(e.inArray(i.settings.animation,["fade","slide"])==-1){i.settings.animation="show";i.settings.duration=1}else i.settings.animation+="Toggle"}else{i.settings.animation="show";i.settings.duration=1}i.init()};i.init=function(){e(window).on("throttledresize",function(){i.position(e(this))});s.addClass("timeline-container");s.find(i.settings.item).each(function(){e(this).wrap('<div class="timeline-item" />')});if(i.settings.line!=false){s.prepend('<div class="timeline-central-line" />')}if(i.settings.wide!=false){s.find(i.settings.wide).parent().addClass("timeline-wide-item")}if(i.settings.corner!=false){$corner=s.find(i.settings.corner);s.find(i.settings.item).each(function(){var t=s.find(i.settings.item).index(this);e(this).attr("data-timeline-initial-position",t)});s.find(i.settings.corner).unwrap().detach();if(i.settings.first=="left"){e(s.children(".timeline-item").get(0)).after($corner)}else s.prepend($corner);$corner.wrapAll('<div class="timeline-item timeline-corner-item" />')}if(i.settings.arrows){s.find(".timeline-item:not(.timeline-wide-item)").find(i.settings.item).each(function(){e(this).prepend('<span class="timeline-item-arrow" />')})}if(i.settings.deletebtn){s.find(".timeline-item").find(i.settings.item).each(function(){e(this).prepend('<span class="timeline-item-close '+i.settings.deletebtn+'" />')});e(".timeline-item-close").on("click",function(){if(typeof i.settings.onRemoveItem==="function")i.removeItem({element:e(this),callback:i.settings.onRemoveItem});else i.removeItem(e(this))})}i.position()};i.reload=function(){i.remove();i.init()};i.position=function(){var n=0,r=0;if(typeof i.settings.column=="function"){column=i.settings.column(t)}else column=i.settings.column;if(column==1)s.addClass("timeline-wide-format");else s.removeClass("timeline-wide-format");s.find(".timeline-item").each(function(){if(e(this).hasClass("timeline-wide-item")||column==1){e(this).removeClass("timeline-position-left timeline-position-right").addClass("timeline-position-left");n+=e(this).height();r=n}else{if(n>r||e(this).hasClass("timeline-corner-item")){e(this).removeClass("timeline-position-left timeline-position-right").addClass("timeline-position-right");r+=e(this).height()}else{e(this).removeClass("timeline-position-left timeline-position-right").addClass("timeline-position-left");n+=e(this).height()}}})};i.prepend=function(t){if(typeof t=="undefined"){window.console.error("cannot prepend undefined element");return 0}if(typeof t.element!="undefined"){var n=t.callback;t=t.element}i.remove();var r=e(t).prependTo(s).hide()[i.settings.animation](i.settings.duration,function(){if(i.settings.duration)i.reload();if(n)n(r)});i.init()};i.append=function(t){if(typeof t=="undefined"){window.console.error("cannot append undefined element");return 0}if(typeof t.element!="undefined"){var n=t.callback;t=t.element}i.remove();var r=e(t).appendTo(s).hide()[i.settings.animation](i.settings.duration,function(){if(i.settings.duration)i.reload();if(n)n(r)});i.init()};i.removeItem=function(t){if(typeof t=="undefined"){window.console.error("cannot remove undefined element");return 0}if(typeof t.element!="undefined"){var n=t.callback;var r=t.element}else var r=t;var o=e(r).is(".timeline-item")?e(r):e(r).closest(".timeline-item");if(o.is(".timeline-corner-item"))r=e(r).closest(i.settings.item);else r=o;var u=r.is(i.settings.item)?r:r.find(i.settings.item);var a=s.find(r).index();s.find(i.settings.corner).each(function(){var t=e(this).attr("data-timeline-initial-position");if(t>a)e(this).attr("data-timeline-initial-position",parseInt(t)-1)});r[i.settings.animation](i.settings.duration,function(){r.remove();if(i.settings.duration)i.reload();if(n)n(u)})};i.destroy=function(e){i.remove();if(typeof e=="function")e(s);s.removeData("timeline")};i.remove=function(){if(i.settings.corner!=false){var t=s.find(i.settings.corner);s.find(".timeline-corner-item "+i.settings.corner).detach();s.find(".timeline-corner-item").remove();s.find(".timeline-item "+i.settings.item).unwrap();var n=s.find(i.settings.item+":last").index();t.each(function(){var t=e(this).attr("data-timeline-initial-position");if(t==0)e(this).insertBefore(s.find(i.settings.item).get(parseInt(t))).removeAttr("data-timeline-initial-position");else e(this).insertAfter(s.find(i.settings.item).get(parseInt(t)-1)).removeAttr("data-timeline-initial-position")})}else s.find(".timeline-item "+i.settings.item).unwrap();if(i.settings.line!=false){s.find(".timeline-central-line").remove()}if(i.settings.arrows){s.find(i.settings.item).each(function(){s.find(i.settings.item+" .timeline-item-arrow").remove()})}if(i.settings.deletebtn){s.find(i.settings.item).each(function(){s.find(i.settings.item+" .timeline-item-close").remove()})}s.removeClass("timeline-container");e(window).off("throttledresize")};jQuery.expr[":"].parents=function(e,t,n){return jQuery(e).parents(n[3]).length<1};i.initialize()};e.fn.timeline=function(t){if(typeof t==="string"){var n=Array.prototype.slice.call(arguments,1);this.each(function(){var r=e.data(this,"timeline");if(!r){window.console.error("cannot call methods on timeline prior to initialization; "+"attempted to call method '"+t+"'");return}if(!e.isFunction(r[t])||t.charAt(0)==="_"){window.console.error("no such method '"+t+"' for timeline instance");return}r[t].apply(r,n)})}else{return this.each(function(){if(undefined==e(this).data("timeline")){var n=new e.timeline(this,t);e(this).data("timeline",n)}else{e(this).data("timeline").destroy();var n=new e.timeline(this,t);e(this).data("timeline",n)}})}}})(jQuery)